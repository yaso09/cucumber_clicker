<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SalatalÄ±k DoÄŸra</title>

<style>
*{box-sizing:border-box;user-select:none;font-family:system-ui,sans-serif}
body{margin:0;background:#0f0f0f;color:#fff}
#game{display:flex;flex-direction:column;height:100vh}
header{display:flex;justify-content:space-between;padding:12px;background:#1b1b1b;font-weight:bold}
main{flex:1;display:flex;justify-content:center;align-items:center}
#chop-area{position:relative;width:260px;height:260px}
#knife{position:absolute;top:-60px;left:50%;width:130px;transform:translateX(-50%) rotate(-12deg)}
#knife.chop{animation:chop .28s}
@keyframes chop{60%{transform:translateX(-50%) translateY(135px) rotate(28deg)}}
#cucumber{position:absolute;bottom:35px;left:50%;width:190px;transform:translateX(-50%)}

nav{display:flex;padding:10px;background:#1b1b1b}
nav button{flex:1;margin:0 5px;padding:12px;border-radius:14px;border:none;background:#2a2a2a;color:#fff}

.modal{position:fixed;inset:0;background:#0f0f0ff5;padding:20px;z-index:100;overflow:auto}
.hidden{display:none}
.item{background:#1f1f1f;padding:12px;border-radius:12px;margin-bottom:12px}
.factory{border:1px solid #333}
.inactive{opacity:.5;filter:grayscale(1)}
.close{width:100%;padding:12px;background:#444;border:none;color:#fff;border-radius:10px}

.bar{height:8px;background:#333;border-radius:4px;overflow:hidden;margin-top:6px}
.bar div{height:100%;background:#4caf50}

.jar{
  font-size:36px;
  text-align:center;
  animation:shake .5s infinite;
  margin:6px 0;
}
@keyframes shake{
  0%{transform:rotate(0)}
  25%{transform:rotate(4deg)}
  50%{transform:rotate(0)}
  75%{transform:rotate(-4deg)}
}
</style>
</head>

<body>

<audio id="bgm" src="/assets/sounds/background.mp3" loop></audio>

<div id="game">

<header>
  <div>ğŸ¥’ <span id="count">0</span></div>
  <div>ğŸ¥« <span id="pickles">0</span></div>
  <div>ğŸ’° <span id="money">0</span></div>
</header>

<main>
  <div id="chop-area">
    <img id="knife" src="/assets/images/knife_basic.svg">
    <img id="cucumber" src="/assets/images/cucumber.svg">
  </div>
</main>

<nav>
  <button onclick="openModal('market')">ğŸ›’ Market</button>
  <button onclick="openModal('factories')">ğŸ­ Fabrikalar</button>
  <button onclick="openModal('aunts')">ğŸ‘µ Teyzeler</button>
  <button onclick="openModal('pickle')">ğŸ¥« TurÅŸu</button>
  <button onclick="openModal('bazaar')">ğŸ’° Pazar</button>
</nav>
</div>

<!-- MARKET -->
<div id="market" class="modal hidden">
<h2>ğŸ›’ Market</h2>
<div class="item">
<strong>Mini Fabrika</strong>
<p>1 ğŸ¥’ / sn</p>
<button onclick="buyFactory()">100 ğŸ’°</button>
</div>
<div class="item">
<strong>TurÅŸucu Teyze</strong>
<p>0.2 ğŸ¥« / sn</p>
<button onclick="buyAunt()">150 ğŸ’°</button>
</div>
<button class="close" onclick="closeModals()">Kapat</button>
</div>

<!-- FACTORIES -->
<div id="factories" class="modal hidden">
<h2>ğŸ­ Fabrikalar</h2>
<div id="factoryList"></div>
<button class="close" onclick="closeModals()">Kapat</button>
</div>

<!-- AUNTS -->
<div id="aunts" class="modal hidden">
<h2>ğŸ‘µ TurÅŸucu Teyzeler</h2>
<div id="auntList"></div>
<button class="close" onclick="closeModals()">Kapat</button>
</div>

<!-- PICKLE -->
<div id="pickle" class="modal hidden">
<h2>ğŸ¥« TurÅŸu Kuruluyor</h2>
<p>10 ğŸ¥’ â†’ 1 ğŸ¥« (5 sn)</p>
<button onclick="startPickle()">TurÅŸu Kur</button>
<div id="pickleList"></div>
<button class="close" onclick="closeModals()">Kapat</button>
</div>

<!-- BAZAAR -->
<div id="bazaar" class="modal hidden">
<h2>ğŸ’° Pazar</h2>
<p>1 ğŸ¥’ = 0.2 ğŸ’°</p>
<button onclick="sellCucumbers(10)">10 ğŸ¥’ Sat</button>
<hr>
<p>1 ğŸ¥« = 3 ğŸ’°</p>
<button onclick="sellPickles(1)">1 ğŸ¥« Sat</button>
<button class="close" onclick="closeModals()">Kapat</button>
</div>

<script>
let state=JSON.parse(localStorage.salatalik||"{}")
Object.assign(state,{
  cucumbers:state.cucumbers||0,
  money:state.money||0,
  factories:state.factories||[],
  aunts:state.aunts||[],
  pickles:state.pickles||0,
  pickleQueue:state.pickleQueue||[]
})

const bgm=document.getElementById("bgm")
document.body.addEventListener("click",()=>bgm.play(),{once:true})

const countEl=document.getElementById("count")
const moneyEl=document.getElementById("money")
const pickleEl=document.getElementById("pickles")
const factoryList=document.getElementById("factoryList")
const auntList=document.getElementById("auntList")
const pickleList=document.getElementById("pickleList")
const knifeEl=document.getElementById("knife")
const chopArea=document.getElementById("chop-area")

function save(){localStorage.salatalik=JSON.stringify(state)}
function updateUI(){
  countEl.textContent=Math.floor(state.cucumbers)
  moneyEl.textContent=Math.floor(state.money)
  pickleEl.textContent=Math.floor(state.pickles)
}

/* CHOP */
chopArea.onclick=()=>{
  state.cucumbers++
  knifeEl.classList.remove("chop");void knifeEl.offsetWidth
  knifeEl.classList.add("chop")
  save();updateUI()
}

/* BUY */
function buyFactory(){
  if(state.money<100)return
  state.money-=100
  state.factories.push({level:1,power:1,health:100,maxHealth:100,upgradeCost:50,active:true})
  save();updateFactories();updateUI()
}
function buyAunt(){
  if(state.money<150)return
  state.money-=150
  state.aunts.push({level:1,power:.2,health:100,maxHealth:100,upgradeCost:70,active:true})
  save();updateAunts();updateUI()
}

/* LISTS */
function updateFactories(){
  factoryList.innerHTML=""
  state.factories.forEach((f,i)=>{
    const eff=f.health/f.maxHealth
    const p=f.active?f.power*f.level*eff:0
    factoryList.innerHTML+=`
    <div class="item factory ${f.active?"":"inactive"}">
      <b>Fabrika #${i+1} â€” Seviye ${f.level}</b>
      <p>${p.toFixed(2)} ğŸ¥’/sn</p>
      <div class="bar"><div style="width:${eff*100}%"></div></div>
      <button onclick="toggleFactory(${i})">${f.active?"Kapat":"AÃ§"}</button>
      <button onclick="upgradeFactory(${i})">Upgrade (${Math.floor(f.upgradeCost)})</button>
    </div>`
  })
}
function updateAunts(){
  auntList.innerHTML=""
  state.aunts.forEach((a,i)=>{
    const eff=a.health/a.maxHealth
    const p=a.active?a.power*a.level*eff:0
    auntList.innerHTML+=`
    <div class="item factory ${a.active?"":"inactive"}">
      <b>ğŸ‘µ Teyze #${i+1} â€” Seviye ${a.level}</b>
      <p>${p.toFixed(2)} ğŸ¥«/sn</p>
      <div class="bar"><div style="width:${eff*100}%"></div></div>
      <button onclick="toggleAunt(${i})">${a.active?"Kapat":"AÃ§"}</button>
      <button onclick="upgradeAunt(${i})">Upgrade (${Math.floor(a.upgradeCost)})</button>
    </div>`
  })
}

/* TOGGLE + UPGRADE */
function toggleFactory(i){state.factories[i].active=!state.factories[i].active;save();updateFactories()}
function toggleAunt(i){state.aunts[i].active=!state.aunts[i].active;save();updateAunts()}
function upgradeFactory(i){
  let f=state.factories[i]
  if(state.money<f.upgradeCost)return
  state.money-=f.upgradeCost
  f.level++;f.maxHealth+=20;f.health=f.maxHealth;f.upgradeCost*=1.6
  save();updateFactories();updateUI()
}
function upgradeAunt(i){
  let a=state.aunts[i]
  if(state.money<a.upgradeCost)return
  state.money-=a.upgradeCost
  a.level++;a.maxHealth+=20;a.health=a.maxHealth;a.upgradeCost*=1.6
  save();updateAunts();updateUI()
}

/* MANUAL PICKLE */
function startPickle(){
  if(state.cucumbers<10)return
  state.cucumbers-=10
  state.pickleQueue.push({time:5})
  save();updateUI()
}

/* SELL */
function sellCucumbers(a){
  if(state.cucumbers<a)return
  state.cucumbers-=a
  state.money+=a*.2
  save();updateUI()
}
function sellPickles(a){
  if(state.pickles<a)return
  state.pickles-=a
  state.money+=a*3
  save();updateUI()
}

/* TICK */
setInterval(()=>{
  state.factories.forEach(f=>{
    if(f.active){state.cucumbers+=f.power*f.level*(f.health/f.maxHealth);f.health-=.08}
  })
  state.aunts.forEach(a=>{
    if(a.active){state.pickles+=a.power*a.level*(a.health/a.maxHealth);a.health-=.05}
  })

  pickleList.innerHTML=""
  state.pickleQueue.forEach((p,i)=>{
    p.time--
    pickleList.innerHTML+=`<div class="jar">ğŸ¥« TurÅŸu kuruluyor...</div>`
    if(p.time<=0){
      state.pickles++
      state.pickleQueue.splice(i,1)
    }
  })

  save();updateUI();updateFactories();updateAunts()
},1000)

function openModal(id){document.getElementById(id).classList.remove("hidden")}
function closeModals(){document.querySelectorAll(".modal").forEach(m=>m.classList.add("hidden"))}

updateUI();updateFactories();updateAunts()
</script>
</body>
</html>

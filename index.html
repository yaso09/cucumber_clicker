<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SalatalÄ±k DoÄŸra</title>

<style>
*{box-sizing:border-box;user-select:none;font-family:system-ui,sans-serif}
body{margin:0;background:#0f0f0f;color:#fff}
#game{display:flex;flex-direction:column;height:100vh}
header{display:flex;justify-content:space-between;padding:12px;background:#1b1b1b;font-weight:bold}
main{flex:1;display:flex;justify-content:center;align-items:center}
#chop-area{position:relative;width:260px;height:260px}
#knife{position:absolute;top:-60px;left:50%;width:130px;transform:translateX(-50%) rotate(-12deg)}
#knife.chop{animation:chop .28s}
@keyframes chop{60%{transform:translateX(-50%) translateY(135px) rotate(28deg)}}
#cucumber{position:absolute;bottom:35px;left:50%;width:190px;transform:translateX(-50%)}

nav{display:flex;padding:10px;background:#1b1b1b}
nav button{flex:1;margin:0 5px;padding:12px;border-radius:14px;border:none;background:#2a2a2a;color:#fff}

.modal{position:fixed;inset:0;background:#0f0f0ff5;padding:20px;z-index:100;overflow:auto}
.hidden{display:none}
.item{background:#1f1f1f;padding:12px;border-radius:12px;margin-bottom:12px}
.factory{border:1px solid #333}
.inactive{opacity:.45;filter:grayscale(1)}
.close{width:100%;padding:12px;background:#444;border:none;color:#fff;border-radius:10px}

.bar{height:8px;background:#333;border-radius:4px;overflow:hidden;margin-top:6px}
.bar div{height:100%;background:#4caf50;transition:width .4s}
</style>
</head>

<body>

<div id="game">

<header>
  <div>ğŸ¥’ <span id="count">0</span></div>
  <div>ğŸ¥« <span id="pickles">0</span></div>
  <div>ğŸ’° <span id="money">0</span></div>
</header>

<main>
  <div id="chop-area">
    <img id="knife" src="/assets/images/knife_basic.svg">
    <img id="cucumber" src="/assets/images/cucumber.svg">
  </div>
</main>

<nav>
  <button onclick="openModal('market')">ğŸ›’ Market</button>
  <button onclick="openModal('factories')">ğŸ­ Fabrikalar</button>
  <button onclick="openModal('aunts')">ğŸ‘µ Teyzeler</button>
  <button onclick="openModal('pickle')">ğŸ¥« TurÅŸu</button>
  <button onclick="openModal('bazaar')">ğŸ’° Pazar</button>
</nav>
</div>

<!-- SESLER -->
<audio id="bgm" src="/assets/sounds/background.mp3" loop></audio>
<audio id="clickSound" src="/assets/sounds/click.wav"></audio>

<!-- MARKET -->
<div id="market" class="modal hidden">
<h2>ğŸ›’ Market</h2>
<div class="item">
<strong>Mini Fabrika</strong>
<p>1 ğŸ¥’ / sn</p>
<button onclick="buyFactory()">100 ğŸ’°</button>
</div>
<div class="item">
<strong>TurÅŸucu Teyze</strong>
<p>0.2 ğŸ¥« / sn</p>
<button onclick="buyAunt()">150 ğŸ’°</button>
</div>
<button class="close" onclick="closeModals()">Kapat</button>
</div>

<!-- FACTORIES -->
<div id="factories" class="modal hidden">
<h2>ğŸ­ Fabrikalar</h2>
<div id="factoryList"></div>
<button class="close" onclick="closeModals()">Kapat</button>
</div>

<!-- AUNTS -->
<div id="aunts" class="modal hidden">
<h2>ğŸ‘µ Teyzeler</h2>
<div id="auntList"></div>
<button class="close" onclick="closeModals()">Kapat</button>
</div>

<!-- PICKLE -->
<div id="pickle" class="modal hidden">
<h2>ğŸ¥« TurÅŸular</h2>
<p>10 ğŸ¥’ â†’ 1 ğŸ¥« (5 sn)</p>
<button onclick="startPickle()">TurÅŸu Kur</button>
<hr>
<div id="pickleList"></div>
<button class="close" onclick="closeModals()">Kapat</button>
</div>

<!-- BAZAAR -->
<div id="bazaar" class="modal hidden">
<h2>ğŸ’° Pazar</h2>
<p>1 ğŸ¥’ = 0.2 ğŸ’°</p>
<button onclick="sellCucumbers(10)">10 ğŸ¥’ Sat</button>
<hr>
<p>1 ğŸ¥« = 3 ğŸ’°</p>
<button onclick="sellPickles(1)">1 ğŸ¥« Sat</button>
<button class="close" onclick="closeModals()">Kapat</button>
</div>

<script>
let state=JSON.parse(localStorage.salatalik||"{}")
Object.assign(state,{
  cucumbers:state.cucumbers||0,
  money:state.money||0,
  factories:state.factories||[],
  aunts:state.aunts||[],
  pickles:state.pickles||[],
  pickleQueue:state.pickleQueue||[]
})

const countEl=document.getElementById("count")
const moneyEl=document.getElementById("money")
const pickleEl=document.getElementById("pickles")
const pickleList=document.getElementById("pickleList")
const knifeEl=document.getElementById("knife")
const chopArea=document.getElementById("chop-area")

const bgm=document.getElementById("bgm")
const clickSound=document.getElementById("clickSound")
bgm.volume=0.25
clickSound.volume=0.6

function playClick(){
  clickSound.currentTime=0
  clickSound.play()
  if(bgm.paused) bgm.play()
}

function save(){localStorage.salatalik=JSON.stringify(state)}
function updateUI(){
  countEl.textContent=Math.floor(state.cucumbers)
  moneyEl.textContent=Math.floor(state.money)
  pickleEl.textContent=state.pickles.filter(p=>!p.spoiled).length
}

/* CHOP */
chopArea.onclick=()=>{
  playClick()
  state.cucumbers++
  knifeEl.classList.remove("chop");void knifeEl.offsetWidth
  knifeEl.classList.add("chop")
  save();updateUI()
}

/* RANDOM REAL DATE */
function randomExpiry(){
  const now=Date.now()
  const days=(Math.random()*6+1)*24*60*60*1000
  return {created:now,expires:now+days,spoiled:false}
}

/* PICKLE */
function startPickle(){
  playClick()
  if(state.cucumbers<10)return
  state.cucumbers-=10
  state.pickleQueue.push({time:5})
  save();updateUI()
}

/* SELL */
function sellCucumbers(a){
  playClick()
  if(state.cucumbers<a)return
  state.cucumbers-=a
  state.money+=a*.2
  save();updateUI()
}
function sellPickles(a){
  playClick()
  const good=state.pickles.filter(p=>!p.spoiled)
  if(good.length<a)return
  for(let i=0;i<a;i++){
    state.pickles.splice(state.pickles.indexOf(good[i]),1)
  }
  state.money+=a*3
  save();updateUI();updatePickleList()
}

/* PICKLE LIST */
function updatePickleList(){
  pickleList.innerHTML=""
  state.pickles.forEach((p,i)=>{
    const total=p.expires-p.created
    const left=Math.max(0,p.expires-Date.now())
    const percent=(left/total)*100
    const date=new Date(p.expires).toLocaleDateString("tr-TR")

    pickleList.innerHTML+=`
    <div class="item ${p.spoiled?"inactive":""}">
      ğŸ¥« TurÅŸu #${i+1}<br>
      SKT: ${date}<br>
      ${p.spoiled?"âŒ Bozuldu":""}
      <div class="bar"><div style="width:${percent}%"></div></div>
    </div>`
  })
}

/* TICK */
setInterval(()=>{
  state.pickleQueue.forEach((p,i)=>{
    p.time--
    if(p.time<=0){
      state.pickles.push(randomExpiry())
      state.pickleQueue.splice(i,1)
    }
  })

  state.pickles.forEach(p=>{
    if(!p.spoiled && Date.now()>p.expires)p.spoiled=true
  })

  save();updateUI();updatePickleList()
},1000)

function openModal(id){playClick();document.getElementById(id).classList.remove("hidden")}
function closeModals(){playClick();document.querySelectorAll(".modal").forEach(m=>m.classList.add("hidden"))}

updateUI();updatePickleList()
</script>
</body>
</html>
